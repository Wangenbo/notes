## 安全规范

### 一、Cookie使用
- 禁止「MUST NOT」给 baidu.com 域下设置 cookie，设置 cookie 请指定为当前域名。

- 禁止「MUST NOT」给页面设置 document.domain = "baidu.com"。

### 二、隐私数据
- 禁止「MUST NOT」在页面中出现 ip 相关信息 ，如有提交 ip 给 server 端的需求，请修改为其它形式，比如：由 rd 在 server 端间接获取 ip 信息。

- 用户的个人隐私信息：姓名、邮箱、电话、QQ 等，必须「MUST」遵守最小化原则，使用不到信息 禁止「MUST NOT」 出现在页面代码中，获取这些数据的 json 接口也必 「MUST」须经过权限控制。



### 三、页面跳转
- 获取 url 中的参数，跳转至另一个站点时， 禁止「MUST NOT」跳转至任意站点，「MUST」设置白名单，只允许跳转至规定的站点。

- 点击页面中的链接跳转至第三方站点的时候，建议「RECOMMENDED」 以类似百度、 Google 搜索结果中 Server 端跳转的形式进行，后端可以对 URL 进行安全性扫描，检测到是一个恶意网站、或者目标资源是可执行文件时，应给予用户强烈的警告，告知其风险。


### 四、第三方功能和资源
- 页面中嵌入的第三方功能，禁止「MUST NOT」直接内嵌第三方 JS 代码，建议以「RECOMMENDED」iframe 形式引入 。

- 页面中如果需要使用第三方的数据，建议 「RECOMMENDED」 由 RD 获取，尽量避免以 jsonp 方式获取，如必须使用 jsonp，请限制好第三方返回的 callback 函数名，对于不允许使用的函数名称，一律禁止。

- 原则上禁止「MUST NOT」使用第三方提供的资源：图片、文档等，如有必须，建议「RECOMMENDED」由 RD 抓取相关内容转存至自有 Server。因为，外链会产生站外请求，可以被利用实施 CSRF 攻击，而且往往存在性能问题。


### 五、上传文件
- 建议「RECOMMENDED」上传接口所在的域名和主域名隔离，并且采用最小化原则限制允许上传的文件大小。

### 六、JSON/JSONP协议
- JSON 数据，必须「MUST」设置 http header Content-Type : application/json

- 以 JSONP 形式向第三方提供数据，必须「MUST」设置 http header Content-Type : application/javascript，并且callback function 名称只允许出现：数组、字母、下划线。

- JSON/JSONP 方式提供数据，建议「RECOMMENDED」遵循最小化原则，只暴露需要暴露的信息，并且用白名单限制 referer 防止恶意抓取。

### 七、Cross Domain 设置
- 在XML Httprequest 2（xhr2） 以及 font-face 如果需要支持跨域访问的需求，禁止「MUST」设置　header 为： Access-Control-Allow-Origin: * ，需要设置为允许访问的地址，比如： Access-Control-Allow-Origin:www.baidu.com

### 八、其他

1. 不要将系统级别的错误直接暴露给用户，而更应该的是把系统抛出的错误信息记录到LOG日志文件中去，告诉用户友好的提示信息。

2. 不管客户端是否做过数据校验，在服务端必须要有数据校验
    - 对用户输入的字符串值进行长度验证（脚本注入攻击必然会大大增加变量值的长度，通过长度验证可以有效避免注入攻击）
    - 对接收的参数进行类型格式化，比如id参数获取后，进行int类型转换
    - 对用户输入的值进行html编码（防御xss跨站攻击）
    - 对用户输入的字符串值包含的单引号、双引号等符号进行转义（防御SQL注入攻击）
    - 对接收的参数内容，去掉任何远程内容的引用（尤其是样式表和javascript）
    
3. 页面输出之前做html转码，不要原内容输出。（防御xss跨站攻击）

4. 不要把机密的信息明文存储，务必进行加密。（这样就算信息被窃取，也不会造成很大损失）

5. 尽量使用cookie的httponly属性，使客户端js脚本无法读取cooie；对cookie内容进行加密。（防御xss跨站攻击-Cookie欺骗）

6. 必须使用参数化SQL命令，永远不要使用动态拼装的SQL命令。（防御SQL注入攻击）

7. 实现session tokens表单令牌，拒绝不明来源的非法提交。

8. 对用户上传的文件尽心更严格限制，例如限制文件类型、文件尺寸等。同时对上传文件后存储的文件目录进行权限限制，去掉脚本执行权限和文件解压权限等。（防御上传入侵）

9. 不要直接暴露文件下载地址，而要把文件下载放到一个逻辑处理程序中，并对每个IP做刷新次数的限制。（防御CC攻击直接通过刷新文件下载而耗尽流量）

10. 页面尽可能把页面做成静态，因为动态网页相对静态网页，对CPU、IO、数据库的性能消耗高很多，做成静态网页可以节约服务器资源，提高服务器性能。（防御DDoS攻击、防御xss攻击和SQL注入攻击）

11. 检查程序漏洞，对程序引用的第三方代码、第三方插件、第三方类库等，要即时更新官方漏洞补丁。

12. 服务器帐号、Ftp帐号、数据库帐号、网站管理员帐号等，要设置足够安全的强度，密码最好不少于12位，并包含大小写字母、数字、特殊字符等。（防御暴力破解攻击）

13. 过滤不必要的端口和服务，可以使用Inexpress、Express、Forwarding等工具来过滤不必要的服务和端口。（防御端口入侵和DDoS端口攻击）

14. 在存在多站的服务器上，严格限制每一个站允许的IP连接数和CPU使用时间。（防御DDoS攻击）

15. 对网站启用https协议，防止数据被窃听，特别是在交易过程中，使用https保证数据传输安全。