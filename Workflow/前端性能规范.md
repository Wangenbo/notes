## 前端性能规范

### 代码优化

#### HTML+CSS

- 符合 XHTML 规范: 小写,正确嵌套,必须关闭;
- 双引号,合理缩进,utf-8编码;
- 标签语义化,便于维护;
- 合理注释,比如 div 关闭的地方表明配对的 div;
- HTML,CSS,JS 分离,方便维护;
- 避免使用 iframe, 否则会阻塞父文档 onload;
- 样式继承,不要重复;
- 不要乱用 href 和 onclick, 他们本质不同,href 偏向资源加载,而 onclick 仅仅是点击;其次 click 事件在 href 之前执行;
- css伪类选择器不宜太多,防止选择器过载;
- 不要让样式难以覆盖,少用!improtant;
- 善于利用样式继承(注意继承和层叠是不一样的概念);
- 不要保留过时的浏览器前缀和兼容性写法;

#### JavaScript
- 标识符简短清晰,不用 1 和 0 代替 true 和 false,合理编写注释,提高代码可读性;
- 定义变量规定变量作用域,以免污染全局,明确let const var 使用场景;
- 长字符串用字符串链接写法,而非跨行。在兼容的情况下,用 ES6 中的多行字符串也更好;
- 不要在 if 和 for 中定义函数,前置没有意义,破坏分支;后者易出现循环参数拖尾的情况;
- 位运算不要大于32位;
- 不要随意重写已有原型,可以用其实例化对象代替,实现实例继承;
- 对象方法尽量返回 this 以便链式调用;
- 设计封装(类,闭包,模块)时,尽量使用严格模式;
- 在内容为 js 的 script 标签上和内容为 css 的 link 标签上省略 type 属性和 lang 属性;
- 注意变量名不要使用保留字和系统全局变量(方法)一样;

### 性能优化

#### 减少页面 reflow
- 修改元素多个样式可以通过修改 className 完成,这样可以把多次 reflow 减少为一次 reflow;
- 修改元素多个样式可以分为三步：先隐藏(display:none), 再修改,最后显示。这样可以把多次 reflow 减少为两次reflow;
- 添加页面内容可以通过将所有内容写入 docuemnt fragment 元素后再一次性 append 到页面中;
- 添加页面内容可以通过将所有内容组成长字符串,再一次性编辑 innerHTML 加入到页面中;
- css(style 标签和 link 标签) 放在 head 中,这样浏览器在加载数据时候可以直接通过 css tree 生成 render tree, 减少不必要的重新渲染;
- 在不影响视觉效果的情况下,尽量减少 js 动画精度;
- div 布局优于 table 布局,因为后者中元素任意属性改名都会对整个表进行回流;

#### 代码细节优化
- 图片 img 标签的 src 不要空着,以免产生多余请求;
- href, url()和 src 中的链接,用//代替http://,/content/a.jpg代替content/a.jpg, 被替代的后者会多发送一个 http 请求;
- 合理优化外链 css 和 JS 以利用缓存;
- 资源控制在25kB之内,否则移动端可能无法缓存;
- 减少不必要的 DOM 节点;
- 十六进制颜色优于 rgb/hsl 函数,图形转换优于动画,css 动画优于 js 动画,少用 hack 写法;
- 尽量避免 css 表达式;
- 不要重复加载相同代码;
- 利用事件委托减少事件定义;
- 利用变量保存多次用到的 DOM 查询结果,减少反复查找;
- 能用 !== 或 ===,就不要用 != 或 ==,减少不必要的隐式类型转换;
- 尽量使用现有的函数方法,比如数组所有元素求和,直接用 reduce 方法, 再考虑用 map 方法,接着考虑 forEach 方法,然后是 for...in, 最后是 for;
- 利用 {} 或 [] 定义对象或数组,比 new Object() 或 new Array() 效率高;
- 避免 String 类型隐式装箱（隐式调用 new String());
- 用 switch 代替过多的 if, 并按判断条件的可能性排序,以便尽早结束判断;
- [].join() 动态生成字符串比字符串链接(+)性能更好;
- nextSibling() 性能比 children 好；
- cloneNode() 比 createElement() 效率高；
- 考虑在页面渲染完毕以后再动态加载辅助用的外部 js 脚本；

### 网络通信

#### 减少通讯链接次数

- css spirit 将多次请求变为1次请求;
- 设置 http头的属性：connection: keep-alive,使得链接为长连接,减少频繁的握手挥手过程;
- 设置合适的 http头的属性：expires, cache-control 和 max-age
- 合理利用浏览器本地缓存,路由缓存,使得一些数据不需要从服务器获取;
- 去除不必要的重定向;
- 合并文件 如 css js脚本;
- 保存(缓存)必要的 Ajax 请求数据;

#### 减少数据传输距离和数据大小

- 压缩代码;
- 使用内容分发网络(cdn), 如 Akamai, Limelight等;
- 使用 Gzip 压缩;
- 使用新的图片格式或矢量图,如 .apng, .webp 和 .svg;
- 必要时, 减小 cookie, 以减少 http 请求中的数据量;
- 尽量用缩写的 css 样式;
- 合理利用服务器缓存,cdn缓存;
- 尽量少用或不用 ETag,一般情况下 Expires 头已经够用了;

#### 合理利用服务器资源

- 使用负载均衡技术,如硬件技术：Alteon, F5和软件技术：Nginx, LVS;
- 减少 DNS 查找时间(控制在20ms~100ms);
- 设置图片服务器;
- 增加 TTL 时长,建议为24hours(引自Steve Souders的《High Performance Web Sites》)

#### SEO
- 完善 meta 标签,discription 简洁明了,keywords 清晰;
- 重要内容不要用 js 或后端语言加载;
- 合理利用 h标签,尤其 h1 标签,有很高权重;
- 图片写上合理的 alt 值;
- URI 控制在 256KB 之内;
- 不要使用 iframe;
- 语义化标签的使用;

#### 其他
- 用多个域名存储网站资源(减小cookie, 节约主域名连接数,突破浏览器并发限制,优化cdn缓存)
- 使用 base64 Encode 图片,减小链接数量和传输大小。